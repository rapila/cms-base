Widget.types.documentation = {

	prepare: function() {
		var _this = this;

		this.container =jQuery('<div/>').addClass('accordion').hide();
		this._element.append(this.container);

		this.panel_prototype = jQuery('<div/>').addClass('panel');
		this.link_prototype = jQuery('<a/>');
		this.video_tutorial = " {{writeString=wns.documentation.video_tutorial}}";
		var heading_prototype = jQuery('<h4/>').append(jQuery('<a/>').attr('href', '#'));

		this.loadDocumentations(function(documentations) {
			var count = 0;
			var main_key = null;
			jQuery.each(documentations, function(key, documentation) {
				if(documentation.is_main) {
					count = 0;
					main_key = key;
					main_url = documentation.url;
					var heading = heading_prototype.clone();
					heading.find('a').text(documentation.title);
					_this.container.append(heading);
					if(documentation.tutorial_only) {
						_this.add_panel_with_link(main_url);
					}
				} else {
					if(count === 0) {
						_this.add_panel_with_link(main_url);
					}
					count++;
					if(documentation.url) {
						var link = _this.link_prototype.clone().text(documentation.title).attr('href', documentation.url);
						_this.append_to_panel(link);
					}
				}
			});

			// append support tab and content
			this.loadSupportTab(function(support) {
				if(support.heading) {
					loaded = false;
					var heading = heading_prototype.clone();
					heading.find('a').text(support.heading);
					_this.container.append(heading);
				}
				if(support.link) {
					var parts_panel = _this.panel_prototype.clone();
					_this.container.append(parts_panel);
					// add link to overview with video tutorial info
					var link = _this.link_prototype.clone().text(support.link_text).attr('href', support.link);
					_this.append_to_panel(link);
				}
				_this.container.accordion({active: 0, heightStyle: 'content', collapsible:false});
				_this.container.show();
			});
		});
	},

	append_to_panel: function(link) {
		this.container.find('div.panel').last().append(link);
	},

	add_panel_with_link: function(url) {
		var parts_panel = this.panel_prototype.clone();
		var link = this.link_prototype.clone().text(this.video_tutorial).attr('href', url);
		parts_panel.append(link);
		this.container.append(parts_panel);
	}
};
